<!DOCTYPE html>
<html>
<head>
    <title>Монитор трансляции</title>
    <meta charset="utf-8">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body style="background: #1a1a1a; color: white; text-align: center; font-family: sans-serif; padding-top: 20px;">

    <h2 id="status">Ожидание подключения...</h2>
    <p id="device-info" style="color: #00ff00; font-size: 24px; font-weight: bold; margin-bottom: 10px; min-height: 30px;"></p>
    
    <div style="position: relative; display: inline-block; width: 95%; max-width: 800px;">
        <video id="remoteVideo" autoplay playsinline muted controls style="width: 100%; border: 5px solid #ff0050; border-radius: 15px; background: black;"></video>
    </div>
    
    <p style="color: #777; margin-top: 20px;">Если видео зависло или черное — <b>кликни по нему</b> или нажми Play.</p>

    <script>
        const MY_ID = '09062012';

        const peer = new Peer(MY_ID, {
            config: {
                'iceServers': [
                    { url: 'stun:stun.l.google.com:19302' },
                    { url: 'stun:stun1.l.google.com:19302' }
                ]
            }
        });

        peer.on('open', (id) => {
            console.log('Панель активна. ID: ' + id);
        });

        peer.on('call', call => {
            const device = call.metadata && call.metadata.device ? call.metadata.device : "Устройство...";
            document.getElementById('device-info').innerText = "ПОДКЛЮЧЕНО: " + device;
            document.getElementById('status').innerText = "ТРАНСЛЯЦИЯ В ПРЯМОМ ЭФИРЕ";

            call.answer(); 
            
            call.on('stream', remoteStream => {
                const video = document.getElementById('remoteVideo');
                video.srcObject = remoteStream;
                
                // Авто-запуск видео
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        console.log("Браузер требует клика для начала видео");
                    });
                }
            });
        });

        peer.on('error', err => {
            console.error('Ошибка PeerJS:', err);
            if(err.type === 'unavailable-id') alert('Ошибка: ID уже занят. Закрой другие вкладки!');
        });
    </script>
</body>
</html>
